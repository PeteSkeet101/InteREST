<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_fix">
    <sys_script_fix action="INSERT_OR_UPDATE">
        <before>false</before>
        <description/>
        <name>test</name>
        <record_for_rollback>true</record_for_rollback>
        <script><![CDATA[var ritmGR = new GlideRecord('sc_req_item');
ritmGR.query(); // Query all RITMs

while (ritmGR.next()) {
    var allTasksClosed = true;
    var taskGR = new GlideRecord('sc_task');
    taskGR.addQuery('request_item', ritmGR.sys_id);
    taskGR.query();

    while (taskGR.next()) {
        if (taskGR.state != '3') { //  '3' is the state code for 'Closed Complete on TASK Table'
            allTasksClosed = false;
            break; // Exit the loop if any task is not closed
        }
    }

    if (allTasksClosed) {
        ritmGR.stage = 'Closed Complete'; // Update stage to 'Complete'
        ritmGR.state = 'Closed Complete'; // Update state to 'Complete'
        ritmGR.update();
    }
}

gs.info("RITM update script completed");]]></script>
        <sys_class_name>sys_script_fix</sys_class_name>
        <sys_created_by>pete</sys_created_by>
        <sys_created_on>2024-05-21 17:55:16</sys_created_on>
        <sys_id>64f81d7997de0ad005ddd48ef053af8b</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>test</sys_name>
        <sys_package display_value="InteREST" source="x_653938_interest">836d672e97ad25103f5e318c1253af3d</sys_package>
        <sys_policy/>
        <sys_scope display_value="InteREST">836d672e97ad25103f5e318c1253af3d</sys_scope>
        <sys_update_name>sys_script_fix_64f81d7997de0ad005ddd48ef053af8b</sys_update_name>
        <sys_updated_by>pete</sys_updated_by>
        <sys_updated_on>2024-05-21 17:55:16</sys_updated_on>
        <unloadable>false</unloadable>
    </sys_script_fix>
</record_update>
